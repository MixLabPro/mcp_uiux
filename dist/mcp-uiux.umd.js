!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MCPUiux={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=r(t),s=n(t),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)};var l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},l.apply(this,arguments)};function a(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{a(r.next(e))}catch(e){s(e)}}function l(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,l)}a((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,r=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){s.label=l[1];break}if(6===l[0]&&s.label<o[1]){s.label=o[1],o=l;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(l);break}o[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}}"function"==typeof SuppressedError&&SuppressedError;var u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.code=n,r.name="MCPError",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),d=function(){function e(e){var t=e.url,n=void 0===t?"http://localhost:8000":t,r=e.onToolsReady,o=e.onToolResult,s=e.onError,i=e.onResourcesReady,l=e.onResourceTemplatesReady,a=e.onPromptsReady,c=e.onReady;this.sessionId=null,this.messageEndpoint=null,this.eventSource=null,this.reconnectAttempts=0,this.maxReconnectAttempts=99,this.reconnectTimeout=1e3,this.reconnectTimer=null,this.pendingCalls=new Map,this.callIdCounter=0,this.serverName=null,this.protocolVersion=null,this.capabilities=null,this.url=n,this.onToolsReady=r,this.onToolResult=o,this.onError=s,this.onResourcesReady=i,this.onResourceTemplatesReady=l,this.onPromptsReady=a,this.onReady=c}return e.prototype.sendJsonRpcRequest=function(e,t,n){return void 0===n&&(n=null),a(this,void 0,void 0,(function(){var r,o;return c(this,(function(s){switch(s.label){case 0:if(!this.messageEndpoint)throw new Error(e+this.sessionId+this.messageEndpoint+"未获取到消息端点");return r=l({jsonrpc:"2.0",method:e,params:t},null!==n&&{id:n}),[4,fetch(this.messageEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})];case 1:if(!(o=s.sent()).ok)throw new Error("请求失败: ".concat(o.status));return[2,o]}}))}))},e.prototype.handleError=function(e,t){var n,r=e instanceof u?e:new u(e instanceof Error?e.message:t);throw null===(n=this.onError)||void 0===n||n.call(this,r),r},e.prototype.executeTool=function(e,t){return a(this,void 0,void 0,(function(){var n,r,o,s=this;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n="".concat(e,"_").concat(this.callIdCounter++),r=new Promise((function(t,r){s.pendingCalls.set(n,{resolve:t,reject:r}),setTimeout((function(){s.pendingCalls.has(n)&&(s.pendingCalls.delete(n),r(new Error("工具执行超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("tools/call",{name:e,arguments:t},n)];case 1:return i.sent(),[2,r];case 2:return o=i.sent(),this.handleError(o,"执行工具失败: ".concat(e)),[3,3];case 3:return[2]}}))}))},e.prototype.connect=function(){return a(this,void 0,void 0,(function(){var e,t,n,r=this;return c(this,(function(o){return e="".concat(this.url),console.log("正在连接 SSE:",e),this.eventSource=new EventSource(e),t=!1,n=!1,this.eventSource.onopen=function(){console.log("SSE 连接已建立"),r.reconnectAttempts=0},this.eventSource.onerror=function(e){var t,n,o;if(console.error("SSE 连接错误:",e),null===(t=r.eventSource)||void 0===t||t.close(),r.eventSource=null,null===(n=r.onError)||void 0===n||n.call(r,new Error("SSE 连接失败")),r.reconnectAttempts<r.maxReconnectAttempts){var s=r.reconnectTimeout*Math.pow(2,r.reconnectAttempts);console.log("将在 ".concat(s,"ms 后尝试重连 (").concat(r.reconnectAttempts+1,"/").concat(r.maxReconnectAttempts,")")),r.reconnectTimer=setTimeout((function(){r.reconnectAttempts++,r.connect()}),s)}else console.error("已达到最大重连次数"),null===(o=r.onError)||void 0===o||o.call(r,new Error("SSE 连接失败，已达到最大重连次数"))},this.eventSource.addEventListener("endpoint",(function(e){return a(r,void 0,void 0,(function(){var n,r,o,s;return c(this,(function(i){switch(i.label){case 0:if(console.log("收到 endpoint 事件:",e.data),(n=e.data).startsWith("http://")||n.startsWith("https://")?this.messageEndpoint=n:(r=new URL(this.url),n.startsWith("/")?this.messageEndpoint="".concat(r.origin).concat(n):this.messageEndpoint="".concat(r.origin,"/").concat(n)),!(o=n.match(/session_id=([^&]+)/)||n.match(/sessionId=([^&]+)/)))return[3,4];if(this.sessionId=o[1],t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initializeSession()];case 2:return i.sent(),[3,4];case 3:return i.sent(),null===(s=this.onError)||void 0===s||s.call(this,new Error("初始化会话失败")),[3,4];case 4:return[2]}}))}))})),this.eventSource.addEventListener("message",(function(e){return a(r,void 0,void 0,(function(){var r,o,s,i,a,u,d,p,f,h,v,m,g,y,E,b,R,w,T,C,S,P,N,_=this;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),r=JSON.parse(e.data),console.log("收到消息:",r),"2.0"!==r.jsonrpc?[3,3]:1!==r.id||!r.result||t?[3,2]:(t=!0,o=r.result.serverInfo,s=o.name,i=o.version,a=r.result.capabilities,this.serverName=s,this.protocolVersion=r.result.protocolVersion,this.capabilities=a,console.log("MCP capabilities:",a),[4,this.handleInitialized(n)]);case 1:return n=c.sent(),null===(v=this.onReady)||void 0===v||v.call(this,{name:s,protocolVersion:this.protocolVersion||"",version:i,capabilities:a}),[3,3];case 2:if(null===(m=r.result)||void 0===m?void 0:m.tools)console.log("获取到工具列表:",this.sessionId,r.result.tools),u=r.result.tools.map((function(e){return l(l({},e),{fromServerName:_.serverName,execute:function(t){return _.executeTool(e.name,t)}})})),null===(g=this.onToolsReady)||void 0===g||g.call(this,u),this.handleCallback(r);else if(null===(y=r.result)||void 0===y?void 0:y.resources)console.log("获取到资源列表:",r.result.resources),null===(E=this.onResourcesReady)||void 0===E||E.call(this,r.result.resources),this.handleCallback(r);else if(null===(b=r.result)||void 0===b?void 0:b.resourceTemplates){if(console.log("获取到资源模板列表:",r.result.resourceTemplates),(d=r.result.resourceTemplates)&&Array.isArray(d)){for(p=0;p<d.length;p++)f=d[p].uri,d[p]=l(l({},d[p]),{uri:f,_variables:this.getTemplateVariables(d[p]),_expandUriByVariables:this.expandUriByVariables});this.capabilities&&!this.capabilities.resourceTemplates&&(this.capabilities.resourceTemplates=d),console.log("缓存资源模板到capabilities:",this.capabilities.resourceTemplates)}null===(R=this.onResourceTemplatesReady)||void 0===R||R.call(this,this.processResourceTemplates(d)),this.handleCallback(r)}else(null===(w=r.result)||void 0===w?void 0:w.prompts)?(console.log("获取到提示列表:",r.result.prompts),null===(T=this.onPromptsReady)||void 0===T||T.call(this,r.result.prompts),this.handleCallback(r)):(null===(C=r.result)||void 0===C?void 0:C.content)?(console.log("工具执行结果:",r),this.handleCallback(r),null===(S=this.onToolResult)||void 0===S||S.call(this,r.result.content,r.result.isError||!1)):"sampling/createMessage"==r.method?(console.log("收到采样消息:",r),(null===(N=null===(P=null==r?void 0:r.params)||void 0===P?void 0:P.metadata)||void 0===N?void 0:N.request_id)&&(r.id=r.params.metadata.request_id,console.log("fix收到采样消息:",r),this.handleCallback(r))):null!=r.id&&(console.log("#callback:",r),this.handleCallback(r));c.label=3;case 3:return[3,5];case 4:return h=c.sent(),console.error("解析消息失败:",h),[3,5];case 5:return[2]}}))}))})),[2]}))}))},e.prototype.initializeSession=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){return console.log("初始化会话"),[2,this.sendJsonRpcRequest("initialize",{protocolVersion:"0.1.0",capabilities:{},clientInfo:{name:"MixCopilot MCP Client",version:"1.0.0"}},1)]}))}))},e.prototype.handleInitialized=function(e){var t;return a(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,7,,8]),[4,this.sendJsonRpcRequest("notifications/initialized",{},null)];case 1:return r.sent(),console.log("handleInitialized",e),e?[3,6]:[4,this.getToolsList()];case 2:return r.sent(),[4,this.getResources()];case 3:return r.sent(),[4,this.getResourceTemplates()];case 4:return r.sent(),[4,this.getPromptsList()];case 5:return r.sent(),[2,!0];case 6:return[3,8];case 7:return n=r.sent(),null===(t=this.onError)||void 0===t||t.call(this,n),[3,8];case 8:return[2,e]}}))}))},e.prototype.handleCallback=function(e){var t,n,r,o=e.id;if(o&&this.pendingCalls.has(o)){var s=this.pendingCalls.get(o).resolve;this.pendingCalls.delete(o),s(null!==(r=null!==(n=null===(t=e.result)||void 0===t?void 0:t.content)&&void 0!==n?n:e.result)&&void 0!==r?r:{method:e.method,params:e.params})}},e.prototype.processResourceTemplates=function(e){var t=this;return e.map((function(e){return l(l({},e),{_variables:t.getTemplateVariables(e),_expandUriByVariables:t.expandUriByVariables})}))},e.prototype.getToolsList=function(){var e;return a(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="tools_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取工具列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("tools/list",{},t)];case 1:return s.sent(),[2,n];case 2:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取工具列表失败")),r;case 3:return[2]}}))}))},e.prototype.getResources=function(){var e;return a(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/list",{},t)];case 2:return s.sent(),[2,n];case 3:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取资源列表失败")),r;case 4:return[2]}}))}))},e.prototype.getResourceTemplates=function(){var e;return a(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_templates_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取动态资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/templates/list",{},t)];case 2:return s.sent(),[2,n];case 3:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取资源列表失败")),r;case 4:return[2]}}))}))},e.prototype.expandUriByVariables=function(e,t){return console.log("expandUriByVariables:",e,t),e.replace(/{([^}]+)}/g,(function(e,n){return void 0!==t[n]?encodeURIComponent(t[n]):""}))},e.prototype.getTemplateVariables=function(e){if(!e)return[];for(var t,n=[],r=/{([^}]+)}/g;null!==(t=r.exec(e.uriTemplate));)n.push(t[1]);return n},e.prototype.readResource=function(e){var t;return a(this,void 0,void 0,(function(){var n,r,o,s=this;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n="resources_read_".concat(this.callIdCounter++),r=new Promise((function(t,r){s.pendingCalls.set(n,{resolve:t,reject:r}),setTimeout((function(){s.pendingCalls.has(n)&&(s.pendingCalls.delete(n),r(new Error("读取资源超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("resources/read",{uri:e},n)];case 1:return i.sent(),[2,r];case 2:throw o=i.sent(),null===(t=this.onError)||void 0===t||t.call(this,o instanceof Error?o:new Error("读取资源失败: ".concat(e))),o;case 3:return[2]}}))}))},e.prototype.getPromptsList=function(){var e;return a(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="prompts_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取提示列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/list",{},t)];case 1:return s.sent(),[2,n];case 2:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取提示列表失败")),r;case 3:return[2]}}))}))},e.prototype.getPrompt=function(e,t){var n;return void 0===t&&(t={}),a(this,void 0,void 0,(function(){var r,o,s,i=this;return c(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),r="prompts_get_".concat(this.callIdCounter++),o=new Promise((function(t,n){i.pendingCalls.set(r,{resolve:t,reject:n}),setTimeout((function(){i.pendingCalls.has(r)&&(i.pendingCalls.delete(r),n(new Error("获取提示超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/get",{name:e,arguments:t},r)];case 1:return l.sent(),[2,o];case 2:throw s=l.sent(),null===(n=this.onError)||void 0===n||n.call(this,s instanceof Error?s:new Error("获取提示失败: ".concat(e))),s;case 3:return[2]}}))}))},e.prototype.reconnect=function(){var e;console.log("手动重新连接..."),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectAttempts=0,null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null,this.connect()},e.prototype.disconnect=function(){var e;this.maxReconnectAttempts=-1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null},e}(),p=o.createContext({mcpClient:null,loading:!1,error:null,reconnect:function(){return a(void 0,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},connect:function(){return a(void 0,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},tools:[],resources:[],resourceTemplates:[],prompts:[]});var f=function(e){var t=e.loading,n=e.error,r=e.tools,o=e.resources;e.resourceTemplates;var i=e.prompts;return s.default.createElement("div",{className:"sci-fi-container"},s.default.createElement("div",{className:"hologram-title"},s.default.createElement("h1",null,"MCP 系统状态监控"),s.default.createElement("div",{className:"status-indicator"},t?s.default.createElement("span",{className:"pulse loading"},"系统扫描中..."):n?s.default.createElement("span",{className:"pulse error"},"警告：系统异常"):s.default.createElement("span",{className:"pulse active"},"系统在线"))),n&&s.default.createElement("div",{className:"error-panel"},s.default.createElement("div",{className:"error-icon"},"⚠"),s.default.createElement("div",{className:"error-message"},n)),!t&&!n&&s.default.createElement("div",{className:"data-grid"},s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"⚡"),s.default.createElement("h2",null,"系统工具库"),s.default.createElement("span",{className:"count"},r.length)),s.default.createElement("div",{className:"scrollable-content"},r.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),e.name)})))),s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"📦"),s.default.createElement("h2",null,"资源矩阵"),s.default.createElement("span",{className:"count"},o.length)),s.default.createElement("div",{className:"scrollable-content"},o.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),decodeURIComponent(e.uri))})))),s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"💡"),s.default.createElement("h2",null,"AI 提示库"),s.default.createElement("span",{className:"count"},i.length)),s.default.createElement("div",{className:"scrollable-content"},i.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),e.name)}))))))};e.MCPProvider=function(e){var n=this,r=e.children,s=t.useState(null),i=s[0],u=s[1],f=t.useState(!1),h=f[0],v=f[1],m=t.useState(null),g=m[0],y=m[1],E=t.useState([]),b=E[0],R=E[1],w=t.useState([]),T=w[0],C=w[1],S=t.useState([]),P=S[0],N=S[1],_=t.useState([]),x=_[0],k=_[1],j=t.useState(null),I=j[0],M=j[1],O=t.useState(""),A=O[0],V=O[1],q=function(e,t){return a(n,void 0,void 0,(function(){var n,r,o;return c(this,(function(s){switch(s.label){case 0:v(!0),y(null),R([]),C([]),N([]),k([]),s.label=1;case 1:return s.trys.push([1,3,,4]),n=new d({url:e,onToolsReady:function(e){console.log("获取到工具列表:",e),R(Array.from(e||[],(function(e){return l(l({},e),{_type:"tool"})})))},onResourcesReady:function(e){console.log("获取到资源列表:",t,e),C(Array.from(e||[],(function(e){var n;if(!t||(null===(n=e.uri)||void 0===n?void 0:n.startsWith(t)))return l(l({},e),{_type:"resource"})})).filter(Boolean))},onResourceTemplatesReady:function(e){console.log("获取到资源变量列表:",t,e),N(Array.from(e||[],(function(e){var n;if(!t||(null===(n=e.uriTemplate)||void 0===n?void 0:n.startsWith(t)))return l(l({},e),{_type:"resourceTemplate"})})).filter(Boolean))},onPromptsReady:function(e){console.log("获取到提示列表:",e),k(Array.from(e||[],(function(e){return l(l({},e),{_type:"prompt"})})).filter(Boolean))},onError:function(e){var t=e.message||"未知错误";console.error("MCP客户端连接失败:",e),y("连接失败: ".concat(t))},onReady:function(e){console.log("MCP客户端连接成功",e)}}),[4,n.connect()];case 2:return s.sent(),window.mcpClient=n,u(n),v(!1),[2,n];case 3:return r=s.sent(),o=r instanceof Error?r.message:"未知错误",console.error("MCP客户端连接失败:",r),y("连接失败: ".concat(o)),v(!1),[2,null];case 4:return[2]}}))}))},U=function(e,t){return a(n,void 0,void 0,(function(){var n,r;return c(this,(function(o){switch(o.label){case 0:if(n=e||I||(null==i?void 0:i.url)||"http://127.0.0.1:8080",r=void 0!==t?t:A,i)try{i.disconnect()}catch(e){console.warn("关闭旧连接时出错:",e)}return console.log("正在重新连接MCP服务..."),[4,q(n,r)];case 1:return o.sent()&&!e&&(M(n),V(r)),[2]}}))}))};return t.useEffect((function(){if(g&&I){var e=setTimeout((function(){console.log("检测到连接错误，尝试自动重连..."),U()}),5e3);return function(){return clearTimeout(e)}}}),[g,I]),t.useEffect((function(){return function(){if(i)try{i.disconnect()}catch(e){console.warn("关闭连接时出错:",e)}}}),[i]),o.createElement(p.Provider,{value:{mcpClient:i,loading:h,error:g,reconnect:U,connect:function(e,t){return a(n,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:if(console.log(i),i)try{i.disconnect()}catch(e){console.warn("关闭旧连接时出错:",e)}return n=t||"",console.log("正在连接MCP服务..."),[4,q(e,n)];case 1:return r.sent()&&(M(e),V(n)),[2]}}))}))},tools:b,resources:T,resourceTemplates:P,prompts:x}},r)},e.MCPStatus=function(e){var n=e.serverUrl,r=void 0===n?"http://localhost:8080":n,o=e.resourcePath,i=void 0===o?"":o,l=e.className,a=e.style,c=e.render,u=t.useContext(p),d=u.connect,h=u.loading,v=u.error,m=u.tools,g=u.resources,y=u.resourceTemplates,E=u.prompts;return t.useEffect((function(){d(r,i)}),[r,i]),c?c({loading:h,error:v,tools:m,resources:g,resourceTemplates:y,prompts:E}):s.default.createElement("div",{className:l,style:a},s.default.createElement(f,{loading:h,error:v,tools:m,resources:g,resourceTemplates:y,prompts:E}))},e.useMCP=function(e){var n=e.url,r=void 0===n?"http://localhost:8000":n,o=e.onToolsReady,s=e.onToolResult,i=e.onError,l=e.onReady,p=t.useRef(null);return t.useEffect((function(){return p.current=new d({url:r,onToolsReady:o,onToolResult:s,onError:i,onReady:l}),p.current.connect(),function(){var e;null===(e=p.current)||void 0===e||e.disconnect()}}),[r,o,s,i,l]),{executeTool:t.useCallback((function(e,t){return a(void 0,void 0,void 0,(function(){return c(this,(function(n){if(!p.current)throw new u("MCP客户端未初始化");return[2,p.current.executeTool(e,t)]}))}))}),[]),reconnect:t.useCallback((function(){var e;null===(e=p.current)||void 0===e||e.reconnect()}),[]),getResources:t.useCallback((function(){return a(void 0,void 0,void 0,(function(){var e;return c(this,(function(t){return[2,null===(e=p.current)||void 0===e?void 0:e.getResources()]}))}))}),[]),readResource:t.useCallback((function(e){return a(void 0,void 0,void 0,(function(){var t;return c(this,(function(n){return[2,null===(t=p.current)||void 0===t?void 0:t.readResource(e)]}))}))}),[]),getToolsList:t.useCallback((function(){return a(void 0,void 0,void 0,(function(){var e;return c(this,(function(t){return[2,null===(e=p.current)||void 0===e?void 0:e.getToolsList()]}))}))}),[]),getPromptsList:t.useCallback((function(){return a(void 0,void 0,void 0,(function(){var e;return c(this,(function(t){return[2,null===(e=p.current)||void 0===e?void 0:e.getPromptsList()]}))}))}),[]),getPrompt:t.useCallback((function(e,t){return void 0===t&&(t={}),a(void 0,void 0,void 0,(function(){var n;return c(this,(function(r){return[2,null===(n=p.current)||void 0===n?void 0:n.getPrompt(e,t)]}))}))}),[]),getResourceTemplates:t.useCallback((function(){return a(void 0,void 0,void 0,(function(){var e;return c(this,(function(t){return[2,null===(e=p.current)||void 0===e?void 0:e.getResourceTemplates()]}))}))}),[]),expandUriByVariables:t.useCallback((function(e,t){var n;return null===(n=p.current)||void 0===n?void 0:n.expandUriByVariables(e,t)}),[]),getTemplateVariables:t.useCallback((function(e){var t;return(null===(t=p.current)||void 0===t?void 0:t.getTemplateVariables(e))||[]}),[])}},Object.defineProperty(e,"__esModule",{value:!0})}));
