!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MCPUIUX={},e.React)}(this,(function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=r(t),s=n(t),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)};var a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)};function l(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{l(r.next(e))}catch(e){s(e)}}function a(e){try{l(r.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}l((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}"function"==typeof SuppressedError&&SuppressedError;var u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.code=n,r.name="MCPError",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),d=function(){function e(e){var t=e.url,n=void 0===t?"http://localhost:8000":t,r=e.onToolsReady,o=e.onToolResult,s=e.onError,i=e.onResourcesReady,a=e.onResourceTemplatesReady,l=e.onPromptsReady,c=e.onReady;this.sessionId=null,this.messageEndpoint=null,this.eventSource=null,this.reconnectAttempts=0,this.maxReconnectAttempts=99,this.reconnectTimeout=1e3,this.reconnectTimer=null,this.pendingCalls=new Map,this.callIdCounter=0,this.serverName=null,this.protocolVersion=null,this.capabilities=null,this.url=n,this.onToolsReady=r,this.onToolResult=o,this.onError=s,this.onResourcesReady=i,this.onResourceTemplatesReady=a,this.onPromptsReady=l,this.onReady=c}return e.prototype.sendJsonRpcRequest=function(e,t,n){return void 0===n&&(n=null),l(this,void 0,void 0,(function(){var r,o;return c(this,(function(s){switch(s.label){case 0:if(!this.messageEndpoint)throw new Error(e+this.sessionId+this.messageEndpoint+"未获取到消息端点");return r=a({jsonrpc:"2.0",method:e,params:t},null!==n&&{id:n}),[4,fetch(this.messageEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})];case 1:if(!(o=s.sent()).ok)throw new Error("请求失败: ".concat(o.status));return[2,o]}}))}))},e.prototype.handleError=function(e,t){var n,r=e instanceof u?e:new u(e instanceof Error?e.message:t);throw null===(n=this.onError)||void 0===n||n.call(this,r),r},e.prototype.executeTool=function(e,t){return l(this,void 0,void 0,(function(){var n,r,o,s=this;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n="".concat(e,"_").concat(this.callIdCounter++),r=new Promise((function(t,r){s.pendingCalls.set(n,{resolve:t,reject:r}),setTimeout((function(){s.pendingCalls.has(n)&&(s.pendingCalls.delete(n),r(new Error("工具执行超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("tools/call",{name:e,arguments:t},n)];case 1:return i.sent(),[2,r];case 2:return o=i.sent(),this.handleError(o,"执行工具失败: ".concat(e)),[3,3];case 3:return[2]}}))}))},e.prototype.connect=function(){return l(this,void 0,void 0,(function(){var e,t,n,r=this;return c(this,(function(o){return e="".concat(this.url),console.log("正在连接 SSE:",e),this.eventSource=new EventSource(e),t=!1,n=!1,this.eventSource.onopen=function(){console.log("SSE 连接已建立"),r.reconnectAttempts=0},this.eventSource.onerror=function(e){var t,n,o;if(console.error("SSE 连接错误:",e),null===(t=r.eventSource)||void 0===t||t.close(),r.eventSource=null,null===(n=r.onError)||void 0===n||n.call(r,new Error("SSE 连接失败")),r.reconnectAttempts<r.maxReconnectAttempts){var s=r.reconnectTimeout*Math.pow(2,r.reconnectAttempts);console.log("将在 ".concat(s,"ms 后尝试重连 (").concat(r.reconnectAttempts+1,"/").concat(r.maxReconnectAttempts,")")),r.reconnectTimer=setTimeout((function(){r.reconnectAttempts++,r.connect()}),s)}else console.error("已达到最大重连次数"),null===(o=r.onError)||void 0===o||o.call(r,new Error("SSE 连接失败，已达到最大重连次数"))},this.eventSource.addEventListener("endpoint",(function(e){return l(r,void 0,void 0,(function(){var n,r,o,s;return c(this,(function(i){switch(i.label){case 0:if(console.log("收到 endpoint 事件:",e.data),(n=e.data).startsWith("http://")||n.startsWith("https://")?this.messageEndpoint=n:(r=new URL(this.url),n.startsWith("/")?this.messageEndpoint="".concat(r.origin).concat(n):this.messageEndpoint="".concat(r.origin,"/").concat(n)),!(o=n.match(/session_id=([^&]+)/)||n.match(/sessionId=([^&]+)/)))return[3,4];if(this.sessionId=o[1],t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initializeSession()];case 2:return i.sent(),[3,4];case 3:return i.sent(),null===(s=this.onError)||void 0===s||s.call(this,new Error("初始化会话失败")),[3,4];case 4:return[2]}}))}))})),this.eventSource.addEventListener("message",(function(e){return l(r,void 0,void 0,(function(){var r,o,s,i,l,u,d,p,h,f,m,v,g,b,y,E,w,C,T,R,x,S,N,P=this;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),r=JSON.parse(e.data),console.log("收到消息:",r),"2.0"!==r.jsonrpc?[3,3]:1!==r.id||!r.result||t?[3,2]:(t=!0,o=r.result.serverInfo,s=o.name,i=o.version,l=r.result.capabilities,this.serverName=s,this.protocolVersion=r.result.protocolVersion,this.capabilities=l,console.log("MCP capabilities:",l),[4,this.handleInitialized(n)]);case 1:return n=c.sent(),null===(m=this.onReady)||void 0===m||m.call(this,{name:s,protocolVersion:this.protocolVersion||"",version:i,capabilities:l}),[3,3];case 2:if(null===(v=r.result)||void 0===v?void 0:v.tools)console.log("获取到工具列表:",this.sessionId,r.result.tools),u=r.result.tools.map((function(e){return a(a({},e),{fromServerName:P.serverName,execute:function(t){return P.executeTool(e.name,t)}})})),null===(g=this.onToolsReady)||void 0===g||g.call(this,u),this.handleCallback(r);else if(null===(b=r.result)||void 0===b?void 0:b.resources)console.log("获取到资源列表:",r.result.resources),null===(y=this.onResourcesReady)||void 0===y||y.call(this,r.result.resources),this.handleCallback(r);else if(null===(E=r.result)||void 0===E?void 0:E.resourceTemplates){if(console.log("获取到资源模板列表:",r.result.resourceTemplates),(d=r.result.resourceTemplates)&&Array.isArray(d)){for(p=0;p<d.length;p++)h=d[p].uri,d[p]=a(a({},d[p]),{uri:h,_variables:this.getTemplateVariables(d[p]),_expandUriByVariables:this.expandUriByVariables});this.capabilities&&!this.capabilities.resourceTemplates&&(this.capabilities.resourceTemplates=d),console.log("缓存资源模板到capabilities:",this.capabilities.resourceTemplates)}null===(w=this.onResourceTemplatesReady)||void 0===w||w.call(this,this.processResourceTemplates(d)),this.handleCallback(r)}else(null===(C=r.result)||void 0===C?void 0:C.prompts)?(console.log("获取到提示列表:",r.result.prompts),null===(T=this.onPromptsReady)||void 0===T||T.call(this,r.result.prompts),this.handleCallback(r)):(null===(R=r.result)||void 0===R?void 0:R.content)?(console.log("工具执行结果:",r),this.handleCallback(r),null===(x=this.onToolResult)||void 0===x||x.call(this,r.result.content,r.result.isError||!1)):"sampling/createMessage"==r.method?(console.log("收到采样消息:",r),(null===(N=null===(S=null==r?void 0:r.params)||void 0===S?void 0:S.metadata)||void 0===N?void 0:N.request_id)&&(r.id=r.params.metadata.request_id,console.log("fix收到采样消息:",r),this.handleCallback(r))):null!=r.id&&(console.log("#callback:",r),this.handleCallback(r));c.label=3;case 3:return[3,5];case 4:return f=c.sent(),console.error("解析消息失败:",f),[3,5];case 5:return[2]}}))}))})),[2]}))}))},e.prototype.initializeSession=function(){return l(this,void 0,void 0,(function(){return c(this,(function(e){return console.log("初始化会话"),[2,this.sendJsonRpcRequest("initialize",{protocolVersion:"0.1.0",capabilities:{},clientInfo:{name:"MixCopilot MCP Client",version:"1.0.0"}},1)]}))}))},e.prototype.handleInitialized=function(e){var t;return l(this,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,7,,8]),[4,this.sendJsonRpcRequest("notifications/initialized",{},null)];case 1:return r.sent(),console.log("handleInitialized",e),e?[3,6]:[4,this.getToolsList()];case 2:return r.sent(),[4,this.getResources()];case 3:return r.sent(),[4,this.getResourceTemplates()];case 4:return r.sent(),[4,this.getPromptsList()];case 5:return r.sent(),[2,!0];case 6:return[3,8];case 7:return n=r.sent(),null===(t=this.onError)||void 0===t||t.call(this,n),[3,8];case 8:return[2,e]}}))}))},e.prototype.handleCallback=function(e){var t,n,r,o=e.id;if(o&&this.pendingCalls.has(o)){var s=this.pendingCalls.get(o).resolve;this.pendingCalls.delete(o),s(null!==(r=null!==(n=null===(t=e.result)||void 0===t?void 0:t.content)&&void 0!==n?n:e.result)&&void 0!==r?r:{method:e.method,params:e.params})}},e.prototype.processResourceTemplates=function(e){var t=this;return e.map((function(e){return a(a({},e),{_variables:t.getTemplateVariables(e),_expandUriByVariables:t.expandUriByVariables})}))},e.prototype.getToolsList=function(){var e;return l(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="tools_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取工具列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("tools/list",{},t)];case 1:return s.sent(),[2,n];case 2:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取工具列表失败")),r;case 3:return[2]}}))}))},e.prototype.getResources=function(){var e;return l(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/list",{},t)];case 2:return s.sent(),[2,n];case 3:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取资源列表失败")),r;case 4:return[2]}}))}))},e.prototype.getResourceTemplates=function(){var e;return l(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_templates_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取动态资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/templates/list",{},t)];case 2:return s.sent(),[2,n];case 3:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取资源列表失败")),r;case 4:return[2]}}))}))},e.prototype.expandUriByVariables=function(e,t){return console.log("expandUriByVariables:",e,t),e.replace(/{([^}]+)}/g,(function(e,n){return void 0!==t[n]?encodeURIComponent(t[n]):""}))},e.prototype.getTemplateVariables=function(e){if(!e)return[];for(var t,n=[],r=/{([^}]+)}/g;null!==(t=r.exec(e.uriTemplate));)n.push(t[1]);return n},e.prototype.readResource=function(e){var t;return l(this,void 0,void 0,(function(){var n,r,o,s=this;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),n="resources_read_".concat(this.callIdCounter++),r=new Promise((function(t,r){s.pendingCalls.set(n,{resolve:t,reject:r}),setTimeout((function(){s.pendingCalls.has(n)&&(s.pendingCalls.delete(n),r(new Error("读取资源超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("resources/read",{uri:e},n)];case 1:return i.sent(),[2,r];case 2:throw o=i.sent(),null===(t=this.onError)||void 0===t||t.call(this,o instanceof Error?o:new Error("读取资源失败: ".concat(e))),o;case 3:return[2]}}))}))},e.prototype.getPromptsList=function(){var e;return l(this,void 0,void 0,(function(){var t,n,r,o=this;return c(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="prompts_list_".concat(this.callIdCounter++),n=new Promise((function(e,n){o.pendingCalls.set(t,{resolve:e,reject:n}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),n(new Error("获取提示列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/list",{},t)];case 1:return s.sent(),[2,n];case 2:throw r=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,r instanceof Error?r:new Error("获取提示列表失败")),r;case 3:return[2]}}))}))},e.prototype.getPrompt=function(e,t){var n;return void 0===t&&(t={}),l(this,void 0,void 0,(function(){var r,o,s,i=this;return c(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r="prompts_get_".concat(this.callIdCounter++),o=new Promise((function(t,n){i.pendingCalls.set(r,{resolve:t,reject:n}),setTimeout((function(){i.pendingCalls.has(r)&&(i.pendingCalls.delete(r),n(new Error("获取提示超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/get",{name:e,arguments:t},r)];case 1:return a.sent(),[2,o];case 2:throw s=a.sent(),null===(n=this.onError)||void 0===n||n.call(this,s instanceof Error?s:new Error("获取提示失败: ".concat(e))),s;case 3:return[2]}}))}))},e.prototype.reconnect=function(){var e;console.log("手动重新连接..."),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectAttempts=0,null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null,this.connect()},e.prototype.disconnect=function(){var e;this.maxReconnectAttempts=-1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null},e}(),p=o.createContext({mcpClient:null,loading:!1,error:null,reconnect:function(){return l(void 0,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},connect:function(){return l(void 0,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},tools:[],resources:[],resourceTemplates:[],prompts:[]}),h=function(){return t.useContext(p)};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".sci-fi-container{background:#0a0a1f;border-radius:10px;box-shadow:0 0 20px rgba(0,255,255,.2);color:#0ff;padding:2rem}.hologram-title{margin-bottom:2rem;position:relative;text-align:center}.hologram-title h1{color:#0ff;font-size:2.5rem;letter-spacing:3px;text-shadow:0 0 10px rgba(0,255,255,.5);text-transform:uppercase}.status-indicator{margin-top:1rem}.pulse{animation:pulse 2s infinite;border-radius:4px;font-size:.9rem;padding:.5rem 1rem}.pulse.loading{background:#f90;color:#000}.pulse.error{background:#f03;color:#fff}.pulse.active{background:#0f9;color:#000}.data-grid{display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.module{background:rgba(0,255,255,.05);border:1px solid rgba(0,255,255,.2);border-radius:8px;padding:1rem}.module-header{align-items:center;border-bottom:1px solid rgba(0,255,255,.2);display:flex;margin-bottom:1rem;padding-bottom:.5rem}.module-icon{font-size:1.2rem;margin-right:.5rem}.count{background:rgba(0,255,255,.2);border-radius:12px;font-size:.8rem;margin-left:auto;padding:.2rem .6rem}.scrollable-content{max-height:300px;overflow-y:auto;padding-right:.5rem}.item{align-items:center;background:rgba(0,255,255,.05);border-radius:4px;display:flex;margin:.3rem 0;padding:.5rem;transition:all .3s ease}.item:hover{background:rgba(0,255,255,.1);transform:translateX(5px)}.item-indicator{animation:glow 1.5s infinite alternate;background:#0ff;border-radius:50%;height:8px;margin-right:.8rem;width:8px}.error-panel{align-items:center;background:rgba(255,0,0,.1);border:1px solid rgba(255,0,0,.3);border-radius:8px;display:flex;margin:1rem 0;padding:1rem}.error-icon{color:#f03;font-size:2rem;margin-right:1rem}@keyframes pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}@keyframes glow{0%{box-shadow:0 0 5px #0ff}to{box-shadow:0 0 15px #0ff}}.scrollable-content::-webkit-scrollbar{width:6px}.scrollable-content::-webkit-scrollbar-track{background:rgba(0,255,255,.1)}.scrollable-content::-webkit-scrollbar-thumb{background:rgba(0,255,255,.3);border-radius:3px}",{insertAt:"top"});var f=function(e){var t=e.loading,n=e.error,r=e.tools,o=e.resources;e.resourceTemplates;var i=e.prompts;return s.default.createElement("div",{className:"sci-fi-container"},s.default.createElement("div",{className:"hologram-title"},s.default.createElement("h1",null,"MCP 系统状态监控"),s.default.createElement("div",{className:"status-indicator"},t?s.default.createElement("span",{className:"pulse loading"},"系统扫描中..."):n?s.default.createElement("span",{className:"pulse error"},"警告：系统异常"):s.default.createElement("span",{className:"pulse active"},"系统在线"))),n&&s.default.createElement("div",{className:"error-panel"},s.default.createElement("div",{className:"error-icon"},"⚠"),s.default.createElement("div",{className:"error-message"},n)),!t&&!n&&s.default.createElement("div",{className:"data-grid"},s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"⚡"),s.default.createElement("h2",null,"系统工具库"),s.default.createElement("span",{className:"count"},r.length)),s.default.createElement("div",{className:"scrollable-content"},r.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),e.name)})))),s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"📦"),s.default.createElement("h2",null,"资源矩阵"),s.default.createElement("span",{className:"count"},o.length)),s.default.createElement("div",{className:"scrollable-content"},o.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),decodeURIComponent(e.uri))})))),s.default.createElement("div",{className:"module"},s.default.createElement("div",{className:"module-header"},s.default.createElement("span",{className:"module-icon"},"💡"),s.default.createElement("h2",null,"AI 提示库"),s.default.createElement("span",{className:"count"},i.length)),s.default.createElement("div",{className:"scrollable-content"},i.map((function(e,t){return s.default.createElement("div",{key:t,className:"item"},s.default.createElement("span",{className:"item-indicator"}),e.name)}))))))};e.MCPProvider=function(e){var n=this,r=e.children,s=t.useState(null),i=s[0],u=s[1],h=t.useState(!1),f=h[0],m=h[1],v=t.useState(null),g=v[0],b=v[1],y=t.useState([]),E=y[0],w=y[1],C=t.useState([]),T=C[0],R=C[1],x=t.useState([]),S=x[0],N=x[1],P=t.useState([]),_=P[0],k=P[1],I=t.useState(null),j=I[0],A=I[1],O=t.useState(""),M=O[0],V=O[1],q=function(e,t){return l(n,void 0,void 0,(function(){var n,r,o;return c(this,(function(s){switch(s.label){case 0:m(!0),b(null),w([]),R([]),N([]),k([]),s.label=1;case 1:return s.trys.push([1,3,,4]),n=new d({url:e,onToolsReady:function(e){console.log("获取到工具列表:",e),w(Array.from(e||[],(function(e){return a(a({},e),{_type:"tool"})})))},onResourcesReady:function(e){console.log("获取到资源列表:",t,e),R(Array.from(e||[],(function(e){var n;if(!t||(null===(n=e.uri)||void 0===n?void 0:n.startsWith(t)))return a(a({},e),{_type:"resource"})})).filter(Boolean))},onResourceTemplatesReady:function(e){console.log("获取到资源变量列表:",t,e),N(Array.from(e||[],(function(e){var n;if(!t||(null===(n=e.uriTemplate)||void 0===n?void 0:n.startsWith(t)))return a(a({},e),{_type:"resourceTemplate"})})).filter(Boolean))},onPromptsReady:function(e){console.log("获取到提示列表:",e),k(Array.from(e||[],(function(e){return a(a({},e),{_type:"prompt"})})).filter(Boolean))},onError:function(e){var t=e.message||"未知错误";console.error("MCP客户端连接失败:",e),b("连接失败: ".concat(t))},onReady:function(e){console.log("MCP客户端连接成功",e)}}),[4,n.connect()];case 2:return s.sent(),window.mcpClient=n,u(n),m(!1),[2,n];case 3:return r=s.sent(),o=r instanceof Error?r.message:"未知错误",console.error("MCP客户端连接失败:",r),b("连接失败: ".concat(o)),m(!1),[2,null];case 4:return[2]}}))}))},z=function(e,t){return l(n,void 0,void 0,(function(){var n,r;return c(this,(function(o){switch(o.label){case 0:if(n=e||j||(null==i?void 0:i.url)||"http://127.0.0.1:8080",r=void 0!==t?t:M,i)try{i.disconnect()}catch(e){console.warn("关闭旧连接时出错:",e)}return console.log("正在重新连接MCP服务..."),[4,q(n,r)];case 1:return o.sent()&&!e&&(A(n),V(r)),[2]}}))}))};return t.useEffect((function(){if(g&&j){var e=setTimeout((function(){console.log("检测到连接错误，尝试自动重连..."),z()}),5e3);return function(){return clearTimeout(e)}}}),[g,j]),t.useEffect((function(){return function(){if(i)try{i.disconnect()}catch(e){console.warn("关闭连接时出错:",e)}}}),[i]),o.createElement(p.Provider,{value:{mcpClient:i,loading:f,error:g,reconnect:z,connect:function(e,t){return l(n,void 0,void 0,(function(){var n;return c(this,(function(r){switch(r.label){case 0:if(console.log(i),i)try{i.disconnect()}catch(e){console.warn("关闭旧连接时出错:",e)}return n=t||"",console.log("正在连接MCP服务..."),[4,q(e,n)];case 1:return r.sent()&&(A(e),V(n)),[2]}}))}))},tools:E,resources:T,resourceTemplates:S,prompts:_}},r)},e.MCPStatus=function(e){var n=e.serverUrl,r=void 0===n?"http://localhost:8080":n,o=e.resourcePath,i=void 0===o?"":o,a=e.className,l=e.style,c=e.render,u=h(),d=u.connect,p=u.loading,m=u.error,v=u.tools,g=u.resources,b=u.resourceTemplates,y=u.prompts;return t.useEffect((function(){d(r,i)}),[r,i]),c?c({loading:p,error:m,tools:v,resources:g,resourceTemplates:b,prompts:y}):s.default.createElement("div",{className:a,style:l},s.default.createElement(f,{loading:p,error:m,tools:v,resources:g,resourceTemplates:b,prompts:y}))},e.useMCP=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
