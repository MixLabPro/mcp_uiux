!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("survey-react-ui"),require("survey-core")):"function"==typeof define&&define.amd?define(["exports","react","survey-react-ui","survey-core"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MCPUIUX={},e.React,e.surveyReactUi,e.surveyCore)}(this,(function(e,t,r,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var i=s(t),a=o(t),l=function(e,t){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},l(e,t)};var c=function(){return c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},c.apply(this,arguments)};function u(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}l((n=n.apply(e,t||[])).next())}))}function d(e,t){var r,n,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=a(0),i.throw=a(1),i.return=a(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}"function"==typeof SuppressedError&&SuppressedError;var p=function(e){function t(t,r){var n=e.call(this,t)||this;return n.code=r,n.name="MCPError",n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(Error),m=function(){function e(e){var t=e.url,r=void 0===t?"http://localhost:8000":t,n=e.onToolsReady,o=e.onToolResult,s=e.onError,i=e.onResourcesReady,a=e.onResourceTemplatesReady,l=e.onPromptsReady,c=e.onReady,u=e.onNotifications;this.sessionId=null,this.messageEndpoint=null,this.eventSource=null,this.reconnectAttempts=0,this.maxReconnectAttempts=99,this.reconnectTimeout=1e3,this.reconnectTimer=null,this.pendingCalls=new Map,this.callIdCounter=0,this.serverName=null,this.protocolVersion=null,this.capabilities=null,this.url=r,this.onToolsReady=n,this.onToolResult=o,this.onError=s,this.onResourcesReady=i,this.onResourceTemplatesReady=a,this.onPromptsReady=l,this.onReady=c,this.onNotifications=u}return e.prototype.sendJsonRpcRequest=function(e,t,r){return void 0===r&&(r=null),u(this,void 0,void 0,(function(){var n,o;return d(this,(function(s){switch(s.label){case 0:if(!this.messageEndpoint)throw new Error(e+this.sessionId+this.messageEndpoint+"未获取到消息端点");return n=c({jsonrpc:"2.0",method:e,params:t},null!==r&&{id:r}),[4,fetch(this.messageEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if(!(o=s.sent()).ok)throw new Error("请求失败: ".concat(o.status));return[2,o]}}))}))},e.prototype.handleError=function(e,t){var r,n=e instanceof p?e:new p(e instanceof Error?e.message:t);throw null===(r=this.onError)||void 0===r||r.call(this,n),n},e.prototype.executeTool=function(e,t){return u(this,void 0,void 0,(function(){var r,n,o,s=this;return d(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r="".concat(e,"_").concat(this.callIdCounter++),n=new Promise((function(t,n){s.pendingCalls.set(r,{resolve:t,reject:n}),setTimeout((function(){s.pendingCalls.has(r)&&(s.pendingCalls.delete(r),n(new Error("工具执行超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("tools/call",{name:e,arguments:t},r)];case 1:return i.sent(),[2,n];case 2:return o=i.sent(),this.handleError(o,"执行工具失败: ".concat(e)),[3,3];case 3:return[2]}}))}))},e.prototype.connect=function(){return u(this,void 0,void 0,(function(){var e,t,r,n=this;return d(this,(function(o){return e="".concat(this.url),console.log("正在连接 SSE:",e),this.eventSource=new EventSource(e),t=!1,r=!1,this.eventSource.onopen=function(){console.log("SSE 连接已建立"),n.reconnectAttempts=0},this.eventSource.onerror=function(e){var t,r,o;if(console.error("SSE 连接错误:",e),null===(t=n.eventSource)||void 0===t||t.close(),n.eventSource=null,null===(r=n.onError)||void 0===r||r.call(n,new Error("SSE 连接失败")),n.reconnectAttempts<n.maxReconnectAttempts){var s=n.reconnectTimeout*Math.pow(2,n.reconnectAttempts);console.log("将在 ".concat(s,"ms 后尝试重连 (").concat(n.reconnectAttempts+1,"/").concat(n.maxReconnectAttempts,")")),n.reconnectTimer=setTimeout((function(){n.reconnectAttempts++,n.connect()}),s)}else console.error("已达到最大重连次数"),null===(o=n.onError)||void 0===o||o.call(n,new Error("SSE 连接失败，已达到最大重连次数"))},this.eventSource.addEventListener("endpoint",(function(e){return u(n,void 0,void 0,(function(){var r,n,o,s;return d(this,(function(i){switch(i.label){case 0:if(console.log("收到 endpoint 事件:",e.data),(r=e.data).startsWith("http://")||r.startsWith("https://")?this.messageEndpoint=r:(n=new URL(this.url),r.startsWith("/")?this.messageEndpoint="".concat(n.origin).concat(r):this.messageEndpoint="".concat(n.origin,"/").concat(r)),!(o=r.match(/session_id=([^&]+)/)||r.match(/sessionId=([^&]+)/)))return[3,4];if(this.sessionId=o[1],t)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initializeSession()];case 2:return i.sent(),[3,4];case 3:return i.sent(),null===(s=this.onError)||void 0===s||s.call(this,new Error("初始化会话失败")),[3,4];case 4:return[2]}}))}))})),this.eventSource.addEventListener("message",(function(e){return u(n,void 0,void 0,(function(){var n,o,s,i,a,l,u,p,m,f,h,v,g,b,y,E,w,x,T,R,C,S,N,k=this;return d(this,(function(d){switch(d.label){case 0:return d.trys.push([0,4,,5]),n=JSON.parse(e.data),console.log("收到消息:",n),"2.0"!==n.jsonrpc?[3,3]:1!==n.id||!n.result||t?[3,2]:(t=!0,o=n.result.serverInfo,s=o.name,i=o.version,a=n.result.capabilities,this.serverName=s,this.protocolVersion=n.result.protocolVersion,this.capabilities=a,[4,this.handleInitialized(r)]);case 1:return r=d.sent(),null===(f=this.onReady)||void 0===f||f.call(this,{name:s,protocolVersion:this.protocolVersion||"",version:i,capabilities:a}),[3,3];case 2:if(null===(h=n.result)||void 0===h?void 0:h.tools)n.result.tools=n.result.tools.map((function(e){return c(c({},e),{fromServerName:k.serverName,execute:function(t){return k.executeTool(e.name,t)}})})),null===(v=this.onToolsReady)||void 0===v||v.call(this,n.result.tools),this.handleCallback(n);else if(null===(g=n.result)||void 0===g?void 0:g.resources)null===(b=this.onResourcesReady)||void 0===b||b.call(this,n.result.resources),this.handleCallback(n);else if(null===(y=n.result)||void 0===y?void 0:y.resourceTemplates){if((l=n.result.resourceTemplates)&&Array.isArray(l)){for(u=0;u<l.length;u++)p=l[u].uri,l[u]=c(c({},l[u]),{uri:p,_variables:this.getTemplateVariables(l[u]),_expandUriByVariables:this.expandUriByVariables});this.capabilities&&!this.capabilities.resourceTemplates&&(this.capabilities.resourceTemplates=l)}null===(E=this.onResourceTemplatesReady)||void 0===E||E.call(this,this.processResourceTemplates(l)),this.handleCallback(n)}else(null===(w=n.result)||void 0===w?void 0:w.prompts)?(n.result.prompts=n.result.prompts.map((function(e){var t=c(c({},e),{fromServerName:k.serverName});return e.arguments&&(t.execute=function(t){return k.getPrompt(e.name,t)}),t})),null===(x=this.onPromptsReady)||void 0===x||x.call(this,n.result.prompts),this.handleCallback(n)):(null===(T=n.result)||void 0===T?void 0:T.content)?(console.log("工具执行结果:",n),this.handleCallback(n),null===(R=this.onToolResult)||void 0===R||R.call(this,n.result.content,n.result.isError||!1)):"sampling/createMessage"==n.method?(console.log("收到采样消息:",n),(null===(S=null===(C=null==n?void 0:n.params)||void 0===C?void 0:C.metadata)||void 0===S?void 0:S.request_id)&&(n.id=n.params.metadata.request_id,console.log("fix收到采样消息:",n),this.handleCallback(n))):"notifications/message"==n.method&&n.params?(console.log("notifications/message:",n.params),null===(N=this.onNotifications)||void 0===N||N.call(this,n.params)):null!=n.id&&(console.log("#callback:",n),this.handleCallback(n));d.label=3;case 3:return[3,5];case 4:return m=d.sent(),console.error("解析消息失败:",m),[3,5];case 5:return[2]}}))}))})),[2]}))}))},e.prototype.initializeSession=function(){return u(this,void 0,void 0,(function(){return d(this,(function(e){return console.log("初始化会话"),[2,this.sendJsonRpcRequest("initialize",{protocolVersion:"0.1.0",capabilities:{},clientInfo:{name:"MixCopilot MCP Client",version:"1.0.0"}},1)]}))}))},e.prototype.handleInitialized=function(e){var t;return u(this,void 0,void 0,(function(){var r;return d(this,(function(n){switch(n.label){case 0:return n.trys.push([0,7,,8]),[4,this.sendJsonRpcRequest("notifications/initialized",{},null)];case 1:return n.sent(),console.log("handleInitialized",e),e?[3,6]:[4,this.getToolsList()];case 2:return n.sent(),[4,this.getResources()];case 3:return n.sent(),[4,this.getResourceTemplates()];case 4:return n.sent(),[4,this.getPromptsList()];case 5:return n.sent(),[2,!0];case 6:return[3,8];case 7:return r=n.sent(),null===(t=this.onError)||void 0===t||t.call(this,r),[3,8];case 8:return[2,e]}}))}))},e.prototype.handleCallback=function(e){var t,r,n,o=e.id;if(o&&this.pendingCalls.has(o)){var s=this.pendingCalls.get(o).resolve;this.pendingCalls.delete(o),s(null!==(n=null!==(r=null===(t=e.result)||void 0===t?void 0:t.content)&&void 0!==r?r:e.result)&&void 0!==n?n:{method:e.method,params:e.params})}},e.prototype.processResourceTemplates=function(e){var t=this;return e.map((function(e){return c(c({},e),{_variables:t.getTemplateVariables(e),_expandUriByVariables:t.expandUriByVariables})}))},e.prototype.getToolsList=function(){var e;return u(this,void 0,void 0,(function(){var t,r,n,o=this;return d(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="tools_list_".concat(this.callIdCounter++),r=new Promise((function(e,r){o.pendingCalls.set(t,{resolve:e,reject:r}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),r(new Error("获取工具列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("tools/list",{},t)];case 1:return s.sent(),[2,r];case 2:throw n=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,n instanceof Error?n:new Error("获取工具列表失败")),n;case 3:return[2]}}))}))},e.prototype.getResources=function(){var e;return u(this,void 0,void 0,(function(){var t,r,n,o=this;return d(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_list_".concat(this.callIdCounter++),r=new Promise((function(e,r){o.pendingCalls.set(t,{resolve:e,reject:r}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),r(new Error("获取资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/list",{},t)];case 2:return s.sent(),[2,r];case 3:throw n=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,n instanceof Error?n:new Error("获取资源列表失败")),n;case 4:return[2]}}))}))},e.prototype.getResourceTemplates=function(){var e;return u(this,void 0,void 0,(function(){var t,r,n,o=this;return d(this,(function(s){switch(s.label){case 0:if(!this.capabilities)return[2,[]];s.label=1;case 1:return s.trys.push([1,3,,4]),t="resources_templates_list_".concat(this.callIdCounter++),r=new Promise((function(e,r){o.pendingCalls.set(t,{resolve:e,reject:r}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),r(new Error("获取动态资源列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("resources/templates/list",{},t)];case 2:return s.sent(),[2,r];case 3:throw n=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,n instanceof Error?n:new Error("获取资源列表失败")),n;case 4:return[2]}}))}))},e.prototype.expandUriByVariables=function(e,t){return console.log("expandUriByVariables:",e,t),e.replace(/{([^}]+)}/g,(function(e,r){return void 0!==t[r]?encodeURIComponent(t[r]):""}))},e.prototype.getTemplateVariables=function(e){if(!e)return[];for(var t,r=[],n=/{([^}]+)}/g;null!==(t=n.exec(e.uriTemplate));)r.push(t[1]);return r},e.prototype.readResource=function(e){var t;return u(this,void 0,void 0,(function(){var r,n,o,s=this;return d(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r="resources_read_".concat(this.callIdCounter++),n=new Promise((function(t,n){s.pendingCalls.set(r,{resolve:t,reject:n}),setTimeout((function(){s.pendingCalls.has(r)&&(s.pendingCalls.delete(r),n(new Error("读取资源超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("resources/read",{uri:e},r)];case 1:return i.sent(),[2,n];case 2:throw o=i.sent(),null===(t=this.onError)||void 0===t||t.call(this,o instanceof Error?o:new Error("读取资源失败: ".concat(e))),o;case 3:return[2]}}))}))},e.prototype.getPromptsList=function(){var e;return u(this,void 0,void 0,(function(){var t,r,n,o=this;return d(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),t="prompts_list_".concat(this.callIdCounter++),r=new Promise((function(e,r){o.pendingCalls.set(t,{resolve:e,reject:r}),setTimeout((function(){o.pendingCalls.has(t)&&(o.pendingCalls.delete(t),r(new Error("获取提示列表超时")))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/list",{},t)];case 1:return s.sent(),[2,r];case 2:throw n=s.sent(),null===(e=this.onError)||void 0===e||e.call(this,n instanceof Error?n:new Error("获取提示列表失败")),n;case 3:return[2]}}))}))},e.prototype.getPrompt=function(e,t){var r;return void 0===t&&(t={}),u(this,void 0,void 0,(function(){var n,o,s,i=this;return d(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n="prompts_get_".concat(this.callIdCounter++),o=new Promise((function(t,r){i.pendingCalls.set(n,{resolve:t,reject:r}),setTimeout((function(){i.pendingCalls.has(n)&&(i.pendingCalls.delete(n),r(new Error("获取提示超时: ".concat(e))))}),3e4)})),[4,this.sendJsonRpcRequest("prompts/get",{name:e,arguments:t},n)];case 1:return a.sent(),[2,o];case 2:throw s=a.sent(),null===(r=this.onError)||void 0===r||r.call(this,s instanceof Error?s:new Error("获取提示失败: ".concat(e))),s;case 3:return[2]}}))}))},e.prototype.reconnect=function(){var e;console.log("手动重新连接..."),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnectAttempts=0,null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null,this.connect()},e.prototype.disconnect=function(){var e;this.maxReconnectAttempts=-1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),null===(e=this.eventSource)||void 0===e||e.close(),this.eventSource=null,this.sessionId=null},e}(),f=i.createContext({mcpClient:null,loading:!1,error:null,reconnect:function(){return u(void 0,void 0,void 0,(function(){return d(this,(function(e){return[2]}))}))},connect:function(){return u(void 0,void 0,void 0,(function(){return d(this,(function(e){return[2]}))}))},tools:[],resources:[],resourceTemplates:[],prompts:[],serverInfo:null,notifications:[]}),h=function(){return t.useContext(f)};function v(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===r&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}v(".sci-fi-container{background:#0a0a1f;border-radius:10px;box-shadow:0 0 20px rgba(0,255,255,.2);color:#0ff;padding:2rem}.hologram-title{margin-bottom:2rem;position:relative;text-align:center}.hologram-title h1{color:#0ff;font-size:2.5rem;letter-spacing:3px;text-shadow:0 0 10px rgba(0,255,255,.5);text-transform:uppercase}.status-indicator{margin-top:1rem}.pulse{animation:pulse 2s infinite;border-radius:4px;font-size:.9rem;padding:.5rem 1rem}.pulse.loading{background:#f90;color:#000}.pulse.error{background:#f03;color:#fff}.pulse.active{background:#0f9;color:#000}.data-grid{display:grid;gap:2rem;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}.module{background:rgba(0,255,255,.05);border:1px solid rgba(0,255,255,.2);border-radius:8px;padding:1rem}.module-header{align-items:center;border-bottom:1px solid rgba(0,255,255,.2);display:flex;margin-bottom:1rem;padding-bottom:.5rem}.module-icon{font-size:1.2rem;margin-right:.5rem}.count{background:rgba(0,255,255,.2);border-radius:12px;font-size:.8rem;margin-left:auto;padding:.2rem .6rem}.scrollable-content{max-height:300px;overflow-y:auto;padding-right:.5rem}.item{align-items:center;background:rgba(0,255,255,.05);border-radius:4px;display:flex;margin:.3rem 0;padding:.5rem;transition:all .3s ease}.item:hover{background:rgba(0,255,255,.1);transform:translateX(5px)}.item-indicator{animation:glow 1.5s infinite alternate;background:#0ff;border-radius:50%;height:8px;margin-right:.8rem;width:8px}.error-panel{align-items:center;background:rgba(255,0,0,.1);border:1px solid rgba(255,0,0,.3);border-radius:8px;display:flex;margin:1rem 0;padding:1rem}.error-icon{color:#f03;font-size:2rem;margin-right:1rem}@keyframes pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}@keyframes glow{0%{box-shadow:0 0 5px #0ff}to{box-shadow:0 0 15px #0ff}}.scrollable-content::-webkit-scrollbar{width:6px}.scrollable-content::-webkit-scrollbar-track{background:rgba(0,255,255,.1)}.scrollable-content::-webkit-scrollbar-thumb{background:rgba(0,255,255,.3);border-radius:3px}",{insertAt:"top"});v(".sd-container-modern{margin:18px}.sd-btn{background:rgba(0,255,255,.05);border:none;border-radius:5px;color:#0ff;cursor:pointer;height:32px;margin:12px 0;width:88px}.sd-btn:hover{background:rgba(28,73,73,.1)}.sd-btn:active{background:rgba(2,18,18,.2)}.sd-input{background:rgba(0,255,255,.05);border:none;border-radius:5px;color:#0ff;height:32px;width:88px}",{insertAt:"top"});var g=function(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r=""),!e)return null;var n=t||"field_"+Math.random().toString(36).substr(2,9),o=r||(null==t?void 0:t.replace(/_/g," "))||n;switch(e.type){case"string":return{type:"text",name:n,title:o,isRequired:e.required||!1};case"number":case"integer":return{type:"number",name:n,title:o,isRequired:e.required||!1};case"boolean":return{type:"boolean",name:n,title:o,isRequired:e.required||!1};case"array":return"string"===e.items.type||"number"===e.items.type||"integer"===e.items.type?{type:"matrixdynamic",name:n,title:o,columns:[{cellType:"number"===e.items.type||"integer"===e.items.type?"number":"text",name:"value",title:" "}],rowCount:1,minRowCount:0,addRowText:"添加".concat(o),removeRowText:"删除",isRequired:e.required||!1,showHeader:!1,confirmDelete:!1}:{type:"paneldynamic",name:n,title:o,templateElements:[g(e.items,"item")],panelCount:1,minPanelCount:1,addPanelText:"添加".concat(o),removePanelText:"删除",isRequired:e.required||!1};case"object":var s=Object.entries(e.properties||{}).map((function(e){var t=e[0],r=e[1];return g(r,t)})).filter(Boolean);return t?{type:"panel",name:n,title:o,elements:s,isRequired:e.required||!1}:s;default:return console.warn("Unsupported schema type: ".concat(e.type)),null}},b=function(e){var o=e.tool,s=e.onComplete,i=t.useState(null),l=i[0],p=i[1];return t.useEffect((function(){if(o){var e=function(e){if(!e||!e.inputSchema)return{elements:[]};if("object"===e.inputSchema.type&&(!e.inputSchema.properties||0===Object.keys(e.inputSchema.properties).length))return{elements:[{type:"text",name:"_",title:"_",isRequired:!1}],showQuestionNumbers:!1,showNavigationButtons:!0,completeText:"执行",pageNextText:"下一步",pagePrevText:"上一步"};var t=g(e.inputSchema);return{elements:Array.isArray(t)?t:[t],showQuestionNumbers:!1,completeText:"执行",pageNextText:"下一步",pagePrevText:"上一步"}}(o),t=new n.Model(e);t.onComplete.add((function(e){return u(void 0,void 0,void 0,(function(){var t,r;return d(this,(function(n){switch(n.label){case 0:return s?(t=c({},e.data),o.inputSchema&&"object"===o.inputSchema.type&&o.inputSchema.properties&&Object.entries(o.inputSchema.properties).forEach((function(e){var r=e[0],n=e[1];"array"!==n.type||"string"!==n.items.type&&"number"!==n.items.type&&"integer"!==n.items.type||!Array.isArray(t[r])||(t[r]=t[r].map((function(e){return e.value})))})),p(null),[4,o.execute(t)]):[3,2];case 1:r=n.sent(),s({input:t,output:r}),n.label=2;case 2:return[2]}}))}))})),t.cssVariables={"--sjs-primary-backcolor":"#0a0a1f","--sjs-font-size":"16px","--sjs-border-radius":"8px"},p(t)}}),[o,s]),l?a.default.createElement(r.Survey,{model:l,rootNodeClassName:"mcp-uiux-input-schema-form"}):null},y=function(e){var r=e.serverInfo,n=e.loading,o=e.error,s=e.tools,i=e.resources;e.resourceTemplates;var l=e.prompts,c=e.notifications,u=t.useState(null),d=u[0],p=u[1],m=t.useState(null),f=m[0],h=m[1];return a.default.createElement("div",{className:"sci-fi-container"},a.default.createElement("div",{className:"hologram-title"},a.default.createElement("h1",null,"MCP 系统状态监控"),a.default.createElement("div",{className:"status-indicator"},n?a.default.createElement("span",{className:"pulse loading"},"系统扫描中..."):o?a.default.createElement("span",{className:"pulse error"},"警告：系统异常"):a.default.createElement("span",{className:"pulse active"},"系统在线 ",(null==r?void 0:r.name)&&"- ".concat(r.name)))),o&&a.default.createElement("div",{className:"error-panel"},a.default.createElement("div",{className:"error-icon"},"⚠"),a.default.createElement("div",{className:"error-message"},o)),Object.keys(c).length>0&&a.default.createElement("div",{className:"module",style:{margin:20}},Object.keys(c).map((function(e,t){return a.default.createElement("div",{key:t},e,": ",c[e])}))),!n&&!o&&a.default.createElement("div",{style:{display:"flex"}},a.default.createElement("div",{className:"data-grid"},s.length>0&&a.default.createElement("div",{className:"module"},a.default.createElement("div",{className:"module-header"},a.default.createElement("span",{className:"module-icon"},"⚡"),a.default.createElement("h2",null,"系统工具库"),a.default.createElement("span",{className:"count"},s.length)),a.default.createElement("div",{className:"scrollable-content"},s.map((function(e,t){return a.default.createElement("div",{key:t,className:"item",onClick:function(){return p(e),void h(null)}},a.default.createElement("span",{className:"item-indicator"}),e.name)})))),i.length>0&&a.default.createElement("div",{className:"module"},a.default.createElement("div",{className:"module-header"},a.default.createElement("span",{className:"module-icon"},"📦"),a.default.createElement("h2",null,"资源矩阵"),a.default.createElement("span",{className:"count"},i.length)),a.default.createElement("div",{className:"scrollable-content"},i.map((function(e,t){return a.default.createElement("div",{key:t,className:"item"},a.default.createElement("span",{className:"item-indicator"}),decodeURIComponent(e.uri))})))),l.length>0&&a.default.createElement("div",{className:"module"},a.default.createElement("div",{className:"module-header"},a.default.createElement("span",{className:"module-icon"},"💡"),a.default.createElement("h2",null,"AI 提示库"),a.default.createElement("span",{className:"count"},l.length)),a.default.createElement("div",{className:"scrollable-content"},l.map((function(e,t){return a.default.createElement("div",{key:t,className:"item"},a.default.createElement("span",{className:"item-indicator"}),e.name)}))))),d&&a.default.createElement("div",{className:"module",style:{}},a.default.createElement(b,{tool:d,onComplete:function(e){h(e),p(null)}})),f&&a.default.createElement("div",{className:"module",style:{margin:20}},a.default.createElement("h4",null,"数据"),a.default.createElement("pre",null,JSON.stringify(f,null,2)))))};e.InputSchemaForm=b,e.MCPProvider=function(e){var r=this,n=e.children,o=t.useRef(null),s=t.useState(!1),a=s[0],l=s[1],p=t.useState(null),h=p[0],v=p[1],g=t.useState({}),b=g[0],y=g[1],E=t.useState([]),w=E[0],x=E[1],T=t.useState([]),R=T[0],C=T[1],S=t.useState([]),N=S[0],k=S[1],P=t.useState([]),_=P[0],j=P[1],I=t.useState(null),q=I[0],A=I[1],O=t.useState(null),M=O[0],V=O[1],z=t.useState(""),U=z[0],B=z[1],J=t.useRef(null),L=t.useRef(null),W=function(){return u(r,void 0,void 0,(function(){return d(this,(function(e){if(o.current){try{o.current.disconnect(),o.current=null,x([]),C([]),k([]),j([]),A(null)}catch(e){console.warn("关闭连接时出错:",e)}return[2,new Promise((function(e){return setTimeout(e,200)}))]}return[2,Promise.resolve()]}))}))},D=function(e,t){return u(r,void 0,void 0,(function(){var r,n,s;return d(this,(function(i){switch(i.label){case 0:return l(!0),v(null),o.current?[4,W()]:[3,2];case 1:i.sent(),i.label=2;case 2:x([]),C([]),k([]),j([]),A(null),i.label=3;case 3:return i.trys.push([3,5,,6]),r=new m({url:e,onToolsReady:function(e){console.log("获取到工具列表:",e),x(Array.from(e||[],(function(e){return c(c({},e),{_type:"tool"})})))},onResourcesReady:function(e){console.log("获取到资源列表:",t,e),C(Array.from(e||[],(function(e){var r;if(!t||(null===(r=e.uri)||void 0===r?void 0:r.startsWith(t)))return c(c({},e),{_type:"resource"})})).filter(Boolean))},onResourceTemplatesReady:function(e){console.log("获取到资源变量列表:",t,e),k(Array.from(e||[],(function(e){var r;if(!t||(null===(r=e.uriTemplate)||void 0===r?void 0:r.startsWith(t)))return c(c({},e),{_type:"resourceTemplate"})})).filter(Boolean))},onPromptsReady:function(e){console.log("获取到提示列表:",e),j(Array.from(e||[],(function(e){return c(c({},e),{_type:"prompt"})})).filter(Boolean))},onError:function(e){var t=e.message||"未知错误";console.error("MCP客户端连接失败:",e),v("连接失败: ".concat(t))},onReady:function(e){console.log("MCP客户端连接成功",e),A(e)},onNotifications:function(e){console.log("收到通知消息:",e),y(e)}}),[4,r.connect()];case 4:return i.sent(),window.mcpClient=r,o.current=r,l(!1),[2,r];case 5:return n=i.sent(),s=n instanceof Error?n.message:"未知错误",console.error("MCP客户端连接失败:",n),v("连接失败: ".concat(s)),l(!1),[2,null];case 6:return[2]}}))}))},Q=function(e,t){return u(r,void 0,void 0,(function(){var r,n,s,i=this;return d(this,(function(a){return r=e||M||(null===(s=o.current)||void 0===s?void 0:s.url)||"http://127.0.0.1:8080",n=void 0!==t?t:U,L.current={url:r,filter:n},J.current&&clearTimeout(J.current),J.current=setTimeout((function(){return u(i,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:return(t=L.current)?(L.current=null,[4,W()]):[2];case 1:return r.sent(),console.log("正在重新连接MCP服务...",t.url),[4,D(t.url,t.filter)];case 2:return r.sent()&&!e&&(V(t.url),B(t.filter)),J.current=null,[2]}}))}))}),300),[2]}))}))};return t.useEffect((function(){if(h&&M){var e=setTimeout((function(){console.log("检测到连接错误，尝试自动重连..."),Q()}),5e3);return function(){return clearTimeout(e)}}}),[h,M]),t.useEffect((function(){return function(){if(o.current)try{o.current.disconnect()}catch(e){console.warn("关闭连接时出错:",e)}J.current&&clearTimeout(J.current)}}),[]),i.createElement(f.Provider,{value:{mcpClient:o.current,loading:a,error:h,reconnect:Q,connect:function(e,t){return u(r,void 0,void 0,(function(){var r,n=this;return d(this,(function(o){return e&&e.match("http")?(r=t||"",L.current={url:e,filter:r},J.current&&clearTimeout(J.current),J.current=setTimeout((function(){return u(n,void 0,void 0,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return(e=L.current)?(L.current=null,[4,W()]):[2];case 1:return t.sent(),console.log("正在连接MCP服务...",e.url),[4,D(e.url,e.filter)];case 2:return t.sent()&&(V(e.url),B(e.filter)),J.current=null,[2]}}))}))}),300),[2]):[2]}))}))},tools:w,resources:R,resourceTemplates:N,prompts:_,serverInfo:q,notifications:b}},n)},e.MCPStatus=function(e){var r=e.serverUrl,n=void 0===r?"http://localhost:8080":r,o=e.resourcePath,s=void 0===o?"":o,i=e.className,l=e.style,c=e.render,u=h(),d=u.connect,p=u.loading,m=u.error,f=u.tools,v=u.resources,g=u.resourceTemplates,b=u.prompts,E=u.serverInfo,w=u.notifications;return t.useEffect((function(){d(n,s)}),[n,s]),c?c({loading:p,error:m,tools:f,resources:v,resourceTemplates:g,prompts:b,notifications:w}):a.default.createElement("div",{className:i,style:l},a.default.createElement(y,{serverInfo:E,loading:p,error:m,tools:f,resources:v,resourceTemplates:g,prompts:b,notifications:w}))},e.useMCP=h,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.umd.min.js.map
